<template>
    <div>
        <NavbarRecrutador />

        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
        <div class="container mt-5 pt-4">
            <div class="row align-items-end mb-4 pb-2">
                <div class="col-md-8">
                    <div class="section-title text-center text-md-start">
                        <h4 class="title mb-4">Minhas Vagas</h4>
                    </div>
                </div><!--end col-->

                <!-- <div class="col-md-4 mt-4 mt-sm-0 d-none d-md-block">
                    <div class="text-center text-md-end">
                        <a href="#" class="text-primary">View more Jobs <svg xmlns="http://www.w3.org/2000/svg"
                                width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="feather feather-arrow-right fea icon-sm">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg></a>
                    </div>
                </div> -->
            </div><!--end row-->

            <div class="row">
                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">Full time</span>
                            <h5>Web Designer</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">Remote</span>
                            <h5>Front-end Developer</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">Contract</span>
                            <h5>Web Developer</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">WFH</span>
                            <h5>Back-end Developer</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">Full time</span>
                            <h5>UX / UI Designer</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">Remote</span>
                            <h5>Tester</h5>
                            <div class="mt-3">
                                <span class="text-muted d-block"><i class="fa fa-home" aria-hidden="true"></i> <a
                                        href="#" target="_blank" class="text-muted">Bootdey.com LLC.</a></span>
                                <span class="text-muted d-block"><i class="fa fa-map-marker" aria-hidden="true"></i>
                                    USA</span>
                            </div>

                            <div class="mt-3">
                                <a href="#" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                </div><!--end col-->

                <div class="col-12 mt-4 pt-2 d-block d-md-none text-center">
                    <a href="#" class="btn btn-primary">View more Jobs <svg xmlns="http://www.w3.org/2000/svg"
                            width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-arrow-right fea icon-sm">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg></a>
                </div><!--end col-->
            </div><!--end row-->
        <div class="container p-0">
            <div class="row">
                <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
                    rel="stylesheet" />

                <div class="container mt-5 pt-4">
                    <div class="row align-items-end mb-4 pb-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" v-model="searchTerm"
                                placeholder="Pesquisar por título ou descrição">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" v-model="selectedWorkModel">
                                <option value="">Modelo de Trabalho</option>
                                <option value="remote">Remoto</option>
                                <option value="presential">Presencial</option>
                                <option value="hybrid">Híbrido</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" v-model="selectedJobType">
                                <option value="">Tipo de Trabalho</option>
                                <option value="effective">Efetivo</option>
                                <option value="freelancer">Freelancer</option>
                                <option value="temporary">Temporário</option>
                                <option value="internship">Estágio</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" @click="applyFilters">Filtrar</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-12 mt-4 pt-2" v-for="(vaga, index) in filteredVagas"
                            :key="index">
                            <div class="card border-0 bg-light rounded shadow">
                                <div class="card-body p-4">
                                    <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">
                                        {{ translateWorkModel(vaga.work_model) }}
                                    </span>
                                    <h5>{{ vaga.title }}</h5>
                                    <div class="mt-3">
                                        <span class="text-muted d-block"><i class="fa fa-building"
                                                aria-hidden="true"></i>
                                            <a href="#" target="_blank" class="text-muted"> {{ empresa.company_name
                                                }}</a></span>
                                        <span class="text-muted d-block"><i class="fa fa-briefcase"
                                                aria-hidden="true"></i>
                                            <a href="#" target="_blank" class="text-muted"> {{
                                                translateWorktype(vaga.job_type) }}</a></span>
                                        <span class="text-muted d-block"><i class="fa fa-map-marker"
                                                aria-hidden="true"></i>
                                            {{ vaga.jobs_city }} - {{ vaga.jobs_state }}</span>
                                        <p>{{ truncateDescription(vaga.jobs_description) }}</p>
                                    </div>
                                    <div class="mt-3">
                                        <a href="#" class="btn btn-primary" @click="editVaga(vaga)">Editar</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</template>

<script>
import NavbarRecrutador from '@/components/NavbarRecrutador.vue';
import HttpService from '../services/HttpService';
import { mapGetters } from 'vuex';

export default {
    components: { NavbarRecrutador },
    data() {
        return {
            vaga: {
                title: '',
                work_model: '',
                job_type: '',
                jobs_state: '',
                jobs_city: '',
                jobs_description: '',
                recruiter_id: '',
                company_id: '',
            },
            modeloOptions: [
                { label: 'Presencial', value: 'presential' },
                { label: 'Remoto', value: 'remote' },
                { label: 'Híbrido', value: 'hybrid' },
            ],
            tipoOptions: [
                { label: 'Efetivo', value: 'effective' },
                { label: 'Freelancer', value: 'freelancer' },
                { label: 'Temporário', value: 'temporary' },
                { label: 'Estágio', value: 'internship' },
            ],
            token: localStorage.getItem('authToken') || '',
            searchKeywords: '',
            searchLocation: '',
            searchCompany: '',
            jobs: [
                { id: 1, title: 'Web Developer', company: 'GfG', location: 'India', description: 'Good Web Developer' },
                { id: 2, title: 'Graphic Designer', company: 'Geeksforgeeks', location: 'India', description: 'Good Graphic Designer' }
            ]
        };
    },
    computed: {
        ...mapGetters(['getRecruiterId', 'getCompanyId']),
        filteredJobs() {
            return this.jobs.filter(job => {
                return (
                    (this.searchKeywords === '' || job.title.toLowerCase().includes(this.searchKeywords.toLowerCase())) &&
                    (this.searchLocation === '' || job.location.toLowerCase().includes(this.searchLocation.toLowerCase())) &&
                    (this.searchCompany === '' || job.company.toLowerCase().includes(this.searchCompany.toLowerCase()))
                );
            });
        }
    },
    methods: {
        async createJob() {
            if (!this.validateFields()) return;

            this.vaga.recruiter_id = this.getRecruiterId;
            this.vaga.company_id = this.getCompanyId;

            try {
                const response = await HttpService.post('/jobs/register', this.vaga, {
                    headers: {
                        Authorization: `Bearer ${this.token}`,
            vagas: [],
            filteredVagas: [],
            companies: {},
            empresa: {
                id: '',
                company_name: '',
                company_sector: '',
                about_company: '',
            },
            searchTerm: '',
            selectedWorkModel: '',
            selectedJobType: '',
        };
    },
    created() {
        this.fetchVagas();
        this.fetchCompany();
    },
    computed: {
        ...mapGetters(['getAuthToken', 'getRecruiterId', 'getCompanyId'])
    },
    methods: {

        translateWorkModel(model) {
            const translations = {
                remote: 'Remoto',
                presential: 'Presencial',
                hybrid: 'Híbrido',
            };
            return translations[model];
        },

        translateWorktype(model) {
            const translations = {
                effective: 'Efetivo',
                freelancer: 'Freelancer',
                temporary: 'Temporário',
                internship: 'Estágio',
            };
            return translations[model];
        },
        truncateDescription(description, limit = 200) {
            if (!description) return '';
            return description.length > limit
                ? description.substring(0, limit) + '...'
                : description;
        },
        async fetchVagas() {
            try {
                const response = await HttpService.get('/jobs/show', {
                    headers: {
                        Authorization: `Bearer ${this.getAuthToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 201) {
                    alert('Vaga criada com sucesso!');
                    this.clearForm();
                } else {
                    alert('Erro ao criar a vaga. Tente novamente.');
                }
            } catch (error) {
                console.error('Erro ao criar vaga:', error);
                alert('Erro ao criar a vaga.');
            }
        },
        validateFields() {
            if (!this.vaga.title || !this.vaga.work_model || !this.vaga.job_type || !this.vaga.jobs_state || !this.vaga.jobs_city || !this.vaga.jobs_description) {
                alert('Preencha todos os campos!');
                return false;
            }
            return true;
        },
        clearForm() {
            this.vaga = {
                title: '',
                work_model: '',
                job_type: '',
                jobs_state: '',
                jobs_city: '',
                jobs_description: ''
            };
        },
        searchJobs() {
            console.log('Searching for:', this.searchKeywords, this.searchLocation, this.searchCompany);
            // You can replace this with an actual API call to filter the jobs
        }
    }
};
</script>

                if (response.status === 200) {
                    console.log('Vagas retornadas:', response.data.jobs); // Verifique os dados retornados
                    console.log('Recruiter ID:', this.getRecruiterId); // Verifique o Recruiter ID

                    // Certifique-se de que os tipos de dados coincidam
                    this.vagas = response.data.jobs.filter(vaga =>
                        String(vaga.recruiter_id) === String(this.getRecruiterId)
                    );

                    this.filteredVagas = [...this.vagas];
                } else {
                    alert('Erro ao carregar as vagas.');
                }
            } catch (error) {
                console.error('Erro ao carregar as vagas:', error);
            }
        },


        async fetchCompany() {
            try {
                const response = await HttpService.get(`/company/show/${this.getCompanyId}`, {
                    headers: {
                        Authorization: `Bearer ${this.getAuthToken}`
                    }
                });
                const user = response.data.company;
                this.empresa.id = user.id || '';
                this.empresa.company_name = user.company_name || '';
                this.empresa.company_sector = user.company_sector || '';
                this.empresa.about_company = user.about_company || '';
            } catch (error) {
                console.error('Erro ao carregar o perfil da empresa:', error);
            }
        },
        applyFilters() {
            this.filteredVagas = this.vagas.filter(vaga => {
                const matchesSearchTerm = this.searchTerm
                    ? vaga.title.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                    vaga.jobs_description.toLowerCase().includes(this.searchTerm.toLowerCase())
                    : true;

                const matchesWorkModel = this.selectedWorkModel
                    ? vaga.work_model === this.selectedWorkModel
                    : true;

                const matchesJobType = this.selectedJobType
                    ? vaga.job_type === this.selectedJobType
                    : true;

                return matchesSearchTerm && matchesWorkModel && matchesJobType;
            });
        },
        editVaga(vaga) {
            this.$router.push({
                name: 'UpdateVaga',
                params: { id: vaga.id },
            });
        },

    },
    mounted() {
        this.empresa.id = this.getCompanyId;
    },
};
</script>

<style scoped>
body {
    margin-top: 20px;
}

.shadow {
    box-shadow: 0 0 3px rgb(53 64 78 / 20%) !important;
}

.rounded {
    border-radius: 5px !important;
}

.bg-light {
    background-color: #f7f8fa !important;
}

.bg-primary,
.btn-primary,
.btn-outline-primary:hover,
.btn-outline-primary:focus,
.btn-outline-primary:active,
.btn-outline-primary.active,
.btn-outline-primary.focus,
.btn-outline-primary:not(:disabled):not(.disabled):active,
.badge-primary,
.nav-pills .nav-link.active,
.pagination .active a,
.custom-control-input:checked~.custom-control-label:before,
#preloader #status .spinner>div,
.social-icon li a:hover,
.back-to-top:hover,
.back-to-home a,
::selection,
#topnav .navbar-toggle.open span:hover,
.owl-theme .owl-dots .owl-dot.active span,
.owl-theme .owl-dots.clickable .owl-dot:hover span,
.watch-video a .play-icon-circle,
.sidebar .widget .tagcloud>a:hover,
.flatpickr-day.selected,
.flatpickr-day.selected:hover,
.tns-nav button.tns-nav-active,
.form-check-input.form-check-input:checked {
    background-color: #6dc77a !important;
}

.badge {
    padding: 5px 8px;
    border-radius: 3px;
    letter-spacing: 0.5px;
    font-size: 12px;
}

.btn-primary,
.btn-outline-primary:hover,
.btn-outline-primary:focus,
.btn-outline-primary:active,
.btn-outline-primary.active,
.btn-outline-primary.focus,
.btn-outline-primary:not(:disabled):not(.disabled):active {
    box-shadow: 0 3px 7px rgb(109 199 122 / 50%) !important;
}

.btn-primary,
.btn-outline-primary,
.btn-outline-primary:hover,
.btn-outline-primary:focus,
.btn-outline-primary:active,
.btn-outline-primary.active,
.btn-outline-primary.focus,
.btn-outline-primary:not(:disabled):not(.disabled):active,
.bg-soft-primary .border,
.alert-primary,
.alert-outline-primary,
.badge-outline-primary,
.nav-pills .nav-link.active,
.pagination .active a,
.form-group .form-control:focus,
.form-group .form-control.active,
.custom-control-input:checked~.custom-control-label:before,
.custom-control-input:focus~.custom-control-label::before,
.form-control:focus,
.social-icon li a:hover,
#topnav .has-submenu.active.active .menu-arrow,
#topnav.scroll .navigation-menu>li:hover>.menu-arrow,
#topnav.scroll .navigation-menu>li.active>.menu-arrow,
#topnav .navigation-menu>li:hover>.menu-arrow,
.flatpickr-day.selected,
.flatpickr-day.selected:hover,
.form-check-input:focus,
.form-check-input.form-check-input:checked,
.container-filter li.active,
.container-filter li:hover {
    border-color: #6dc77a !important;
}

.bg-primary,
.btn-primary,
.btn-outline-primary:hover,
.btn-outline-primary:focus,
.btn-outline-primary:active,
.btn-outline-primary.active,
.btn-outline-primary.focus,
.btn-outline-primary:not(:disabled):not(.disabled):active,
.badge-primary,
.nav-pills .nav-link.active,
.pagination .active a,
.custom-control-input:checked~.custom-control-label:before,
#preloader #status .spinner>div,
.social-icon li a:hover,
.back-to-top:hover,
.back-to-home a,
::selection,
#topnav .navbar-toggle.open span:hover,
.owl-theme .owl-dots .owl-dot.active span,
.owl-theme .owl-dots.clickable .owl-dot:hover span,
.watch-video a .play-icon-circle,
.sidebar .widget .tagcloud>a:hover,
.flatpickr-day.selected,
.flatpickr-day.selected:hover,
.tns-nav button.tns-nav-active,
.form-check-input.form-check-input:checked {
    background-color: #6dc77a !important;
}

.btn {
    padding: 8px 20px;
    outline: none;
    text-decoration: none;
    font-size: 16px;
    letter-spacing: 0.5px;
    transition: all 0.3s;
    font-weight: 600;
    border-radius: 5px;
}

.btn-primary {
    background-color: #6dc77a !important;
    border: 1px solid #6dc77a !important;
    color: #fff !important;
    box-shadow: 0 3px 7px rgb(109 199 122 / 50%);
}

a {
    text-decoration: none;
}
</style>
